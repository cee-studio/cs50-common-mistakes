Undefined behavior caused by not understanding free
