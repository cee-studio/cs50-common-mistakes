Undefined behavior caused by using index without modulo N
